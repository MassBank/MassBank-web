!function(){var S={version:"0.0.3"};function s(){return{opts:{title:"",src:[],anno:[],x:"x",y:"y",xlimits:[],ylimits:[],annoTypes:[],annoTexts:[]},raw:{gxlim:[Number.MAX_VALUE,Number.MIN_VALUE],gylim:[Number.MAX_VALUE,Number.MIN_VALUE],ids:{},series:[],minima:0,annoGroups:{}},title:function(t){return t&&"string"==typeof t?this.opts.title=t:console.log("Invalid title option."),this},y:function(t){return t&&"string"==typeof t?this.opts.y=t:console.log("Invalid y accessor option."),this},xlimits:function(t){return t&&t instanceof Array?this.opts.xlimits=t:console.log("Invalid x domain limits."),this},ylimits:function(t){return t&&t instanceof Array?this.opts.ylimits=t:console.log("Invalid y domain limits."),this},add:function(t,s){t instanceof Array?!s||s instanceof Array?(this.opts.src.push.apply(this.opts.src,t),this.opts.anno.push.apply(this.opts.anno,s)):console.log("Raw data and annotation data must be of the same type."):(this.opts.src.push(t),this.opts.anno.push(s))},annotationColumn:function(t,s){t.toUpperCase()in S.annotation?(this.opts.annoTypes.push(t),this.opts.annoTexts.push(s)):console.log("Unknown annotation type: "+t)},remove:function(t){var s=[];if(!t&&0!==t){for(var e in this.raw.ids)s.push(e);return this.raw.ids={},this.raw.series=[],this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE],this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE],s}for(e in t instanceof Array?t.sort():t=[t],t){var a=t[e];if(isNaN(a)){for(var e in this.raw.series)if(this.raw.series[e].id===a){this.raw.series.splice(e,1),s.push(this.raw.ids[a]),delete this.raw.ids[a];break}}else if(a-e<this.raw.series.length){var i=this.raw.series.splice(a-e,1);s.push(i[0].id),delete this.raw.ids[i[0].id]}}return 0===this.raw.series.length&&(this.raw.gxlim=[Number.MAX_VALUE,Number.MIN_VALUE],this.raw.gylim=[Number.MAX_VALUE,Number.MIN_VALUE]),s},id:function(t){return this.raw.series[t].id},titleat:function(t){return this.raw.series[t].title},accs:function(t){return this.raw.series[t].accs},push:function(t){var s=this,e=[];for(var a in this.opts.src)"string"!=typeof this.opts.src[a]?this.fetch(this.opts.src[a],this.opts.anno[a]):e.push(this.fetch(this.opts.src[a],this.opts.anno[a]));$.when.apply($,e).done(function(){s.opts.src.length&&(s.opts.src=[],s.opts.anno=[],s.raw.gxlim[0]===s.raw.gxlim[1]&&(s.raw.gxlim[0]-=s.raw.gxlim[0]/100,s.raw.gxlim[1]+=s.raw.gxlim[1]/100),s.raw.gylim[0]===s.raw.gylim[1]&&(s.raw.gylim[0]-=s.raw.gylim[0]/100,s.raw.gylim[1]+=s.raw.gylim[1]/100),t())})},fetch:function(e,a){var i=this,t=null;if("string"==typeof e)t="string"==typeof a&&a?$.when($.get(e),$.get(a)).fail(function(){console.log("Fetch failed for: "+e+"\n"+a)}).then(function(t,s){if("string"==typeof t&&(t=$.parseJSON(t)),t[0]instanceof Array)for(var e in t[0])i.seriesfetch(t[0][e],s[0][e]);else i.seriesfetch(t[0],s[0])}):$.when($.get(e)).fail(function(){console.log("Fetch failed for: "+e)}).then(function(t){if("string"==typeof t&&(t=$.parseJSON(t)),t instanceof Array)for(var s in a||(a=[]),t)i.seriesfetch(t[s],a[s]);else i.seriesfetch(t,a)});else if("string"==typeof a&&a)t=$.when($.get(a)).fail(function(){console.log("Fetch failed for: "+a)}).then(function(t){if(e instanceof Array)for(var s in a||(a=[]),e)i.seriesfetch(e[s],t[s]);else i.seriesfetch(e,t)});else if(e instanceof Array)for(var s in e)i.seriesfetch(e[s],a[s]);else i.seriesfetch(e,a);return t},reset:function(){for(var t in this.raw.series){var s=this.raw.series[t];s.size=[0,s.data.length,0]}}}}function M(t,s,e,a){var i=[];return(i=2===e.length?isNaN(e[0])&&isNaN(e[1])?[s[e[0]],s[e[1]]]:"number"==typeof e[0]&&"number"==typeof e[1]?[e[0],e[1]]:a&&""!==a?d3.extent(t,function(t){return t[a]}):d3.extent(t):a&&""!==a?d3.extent(t,function(t){return t[a]}):d3.extent(t))[0]=parseFloat(i[0]),i[1]=parseFloat(i[1]),i}function e(){return{opts:{title:"",xlabel:"",ylabel:"",xreverse:!1,yreverse:!1,legend:!1,labels:!1,margins:[80,80,80,120]},data:null,timeout:null,colors:S.util.colors(),mol2svg:S.util.mol2svg(250,250),title:function(t){return t&&"string"==typeof t?this.opts.title=t:console.log("Invalid title option."),this},xlabel:function(t){return t&&"string"==typeof t?this.opts.xlabel=t:console.log("Invalid x-axis label option."),this},ylabel:function(t){return t&&"string"==typeof t?this.opts.ylabel=t:console.log("Invalid y-axis label option."),this},xreverse:function(t){return t&&"boolean"==typeof t?this.opts.xreverse=t:console.log("Invalid x-axis reverse option."),this},yreverse:function(t){return t&&"boolean"==typeof t?this.opts.yreverse=t:console.log("Invalid y-axis reverse option."),this},legend:function(t){return t&&"boolean"==typeof t?this.opts.legend=t:console.log("Invalid legend option."),this},labels:function(t){return t&&"boolean"==typeof t?this.opts.labels=t:console.log("Invalid labels option."),this},margins:function(t){return t&&t instanceof Array&&4===t.length?this.opts.margins=t:console.log("Invalid margins array."),this},render:function(t){this.target=t;var s=this.opts.margins;if(this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2],this.width<=0)console.log("Invalid chart width: "+this.width);else if(this.height<=0)console.log("Invalid chart height: "+this.height);else{var e=this;if(this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]).on("mousedown.zoom",function(){e.mouseDown(this)}).on("mousemove.zoom",function(){e.mouseMove(this)}).on("mouseup.zoom",function(){e.mouseUp()}).on("mouseout",function(){e.mouseOut(this)}).on("dblclick.zoom",function(){e.mouseDbl(this)}),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.scales={},this.opts.xreverse?this.scales.x=d3.scale.linear().domain([1,0]).range([0,this.width]):this.scales.x=d3.scale.linear().domain([0,1]).range([0,this.width]),this.opts.yreverse?this.scales.y=d3.scale.linear().domain([1,0]).range([this.height,0]):this.scales.y=d3.scale.linear().domain([0,1]).range([this.height,0]),$("#st-tooltips").length?this.tooltips=d3.select("#st-tooltips"):(this.tooltips=d3.select("body").append("div").attr("width",$(t).width()).attr("height",$(t).height()).style("pointer-events","none").attr("id","st-tooltips").style("position","absolute").style("opacity",0),this.tooltips.append("div").attr("id","tooltips-meta").style("height","50%").style("width","100%"),this.tooltips.append("div").attr("id","tooltips-mol").style("height","50%").style("width","100%")),"function"==typeof this.behavior&&this.behavior(),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&(s[0]<20?console.log("Not enough space for chart title: increase top margin (min 20)"):this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title)),this.opts.labels){if(s[1]<60)return void console.log("Not enough space for label option: increase right margin (min 60)");var a=this.canvas.append("g").attr("id","st-options");a.append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options");var i=a.append("g");i.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5).attr("r",2).style("fill","#333333").style("stroke","#333333"),i.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2).text("Labels").attr("id","st-label").style("cursor","pointer"),i.on("mousedown",function(){var t=d3.select(this);"none"===t.style("stroke")?t.style("stroke","#333333"):t.style("stroke","none"),o(e)})}}},renderAxes:function(){var t=this.opts.margins,s=d3.format(".4g"),e=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(4).tickFormat(e).orient("left"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate(-25, 0)").call(this.yaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&this.panel.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",0-t[3]/2)},renderlabels:function(t){if(this.opts.labels)if("none"!==this.panel.select("#st-label").style("stroke")&&this.data){var s=[this.scales.x.invert(0),this.scales.x.invert(this.width)];s=S.util.domain(this.scales.x,s);var e,a,i=Math.ceil(this.width/50),n=Math.abs(s[1]-s[0])/(i-1),r=[],o=d3.format(".2f");this.data.raw.minima?(a=10,e=function(t,s){return s<t}):(a=-5,e=function(t,s){return t<s});for(var l=0,h=0,c=0;c<t.length;c++){var d=t[c],p=this.data.accs(c),u=d[0];l+=d.length;for(var f=1;f<d.length;f++){var v=d[f],g=u[p[0]],m=u[p[1]];h=h+m;if(e(v[p[1]],m)){var x=Math.floor((g-s[0])/n),y=r[x];y?e(y[p[1]],m)&&(r[x]=u):r[x]=u}u=v}}h/=l,this.canvas.selectAll(".st-labels").remove();var w=this.canvas.append("g").attr("class","st-labels").attr("text-anchor","middle"),b=0,A=0;for(var c in r)if(r[c]&&e(h,r[c][p[1]])){g=r[c][p[0]];var k=this.scales.x(g),O=this.scales.y(r[c][p[1]]);if(Math.abs(k-b)<20&&Math.abs(O-A)<20){b=k,A=O;continue}b=k;var I="#333333";(A=O)<0&&(O=0,I="gray"),w.append("text").attr("x",k).attr("y",O+a).style("fill",I).text(o(g))}}else this.canvas.selectAll(".st-labels").remove()},rendergroups:function(){if(0!==Object.keys(this.data.raw.annoGroups).length){var i=this,t=this.canvas.select("#st-options"),s=0;null===t[0][0]?(t=this.canvas.append("g").attr("id","st-options")).append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options"):s=15;var e=t.append("g");e.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5+s).attr("r",2).style("fill","#333333").style("stroke","#333333"),e.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2+s).text("Groups").attr("id","st-groups").style("cursor","pointer"),e.on("mouseup",function(){var s=d3.select(this);if("none"===s.style("stroke")){s.style("stroke","#333333");var t=d3.select(i.target).append("div").attr("id","st-popup").style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY+5+"px").style("opacity",.9).style("background-color","white"),e=[];for(var a in i.data.raw.annoGroups)e.push(a);t.append("ul").selectAll("li").data(e).enter().append("li").style("display","block").style("cursor","pointer").html(function(t){return i.data.raw.annoGroups[t]?"<strong>"+t+"</strong>":t}).on("mousedown",function(t){for(a in i.data.raw.annoGroups)a!=t||i.data.raw.annoGroups[t]?i.data.raw.annoGroups[a]=0:i.data.raw.annoGroups[t]=1;i.mouseDbl(),s.style("stroke","none"),$("#st-popup").remove()})}else s.style("stroke","none"),$("#st-popup").remove()})}},mouseDown:function(t){var s=d3.mouse(t),e=this.opts.margins[3],a=this.opts.margins[0];this.panel.select(".st-selection").attr("x",s[0]-e).attr("xs",s[0]-e).attr("y",s[1]-a).attr("ys",s[1]-a).attr("width",1).attr("height",1).attr("display","inline")},mouseMove:function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var e=d3.mouse(t)[0]-this.opts.margins[3],a=d3.mouse(t)[1]-this.opts.margins[0],i=parseInt(s.attr("width"),10),n=parseInt(s.attr("height"),10),r=e-parseInt(s.attr("x"),10),o=a-parseInt(s.attr("y"),10),l=parseInt(s.attr("xs"),10),h=parseInt(s.attr("ys"),10);r<0&&o<0||2*r<i&&2*o<n?(s.attr("x",e),s.attr("width",l-e),s.attr("y",a),s.attr("height",h-a)):r<0||2*r<i?(s.attr("x",e),s.attr("width",l-e),s.attr("height",o)):o<0||2*o<n?(s.attr("y",a),s.attr("height",h-a),s.attr("width",r)):(s.attr("width",r),s.attr("height",o))}},mouseUp:function(){var t=this.panel.select(".st-selection");if(5<parseInt(t.attr("width"))&&5<parseInt(t.attr("height"))){var s=parseFloat(t.attr("x")),e=parseFloat(t.attr("y")),a=parseFloat(t.attr("width")),i=parseFloat(t.attr("height"));if(a=this.scales.x.invert(s+a),i=this.scales.y.invert(e+i),s=this.scales.x.invert(s),e=this.scales.y.invert(e),this.data){var n=this.data.raw.gylim[0];i<n&&(i=n)}this.scales.x.domain([s,a]).nice(),this.scales.y.domain([i,e]).nice(),t.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),o(this)}else t.attr("display","none")},mouseOut:function(t){var s=this.panel.select(".st-selection"),e=d3.mouse(t)[0],a=d3.mouse(t)[1];(e<0||a<0||e>$(this.target).width()||a>$(this.target).height())&&s.attr("display","none")},mouseDbl:function(t){if(t){var s=d3.mouse(t)[0]-this.opts.margins[3],e=d3.mouse(t)[1]-this.opts.margins[0];if(s<0||s>this.width||e<0||e>this.height)return}if(null===this.data){var a=S.util.domain(this.scales.x,[0,1]),i=S.util.domain(this.scales.y,[0,1]);return this.scales.x.domain(a).nice(),this.scales.y.domain(i).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),void this.canvas.select(".st-yaxis").call(this.yaxis)}var n=S.util.domain(this.scales.x,this.data.raw.gxlim),r=S.util.domain(this.scales.y,this.data.raw.gylim);this.scales.x.domain(n).nice(),this.scales.y.domain(r).nice(),this.canvas.select(".st-xaxis").call(this.xaxis),this.canvas.select(".st-yaxis").call(this.yaxis),this.data.reset(),o(this)},mouseOverAction:function(t,s,e,a){this.tooltips.style("display","inline"),this.tooltips.transition().duration(300).style("opacity",.9);var i=d3.format(".4f");this.tooltips.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-10+"px").style("opacity",.9).style("border","dashed").style("border-width","1px").style("padding","3px").style("border-radius","10px").style("z-index","10").style("background-color","white");var n=i(s[e[0]]),r=i(s[e[1]]);d3.selectAll("#tooltips-meta").html(this.opts.xlabel+": "+n+"<br/>"+this.opts.ylabel+": "+r+"<br/>");var o=this;if(a&&""!==a&&s.annos){if(!(a in s.annos))return;var l=s.annos[a],h=d3.selectAll("#tooltips-meta").html();for(var c in l.tooltip)h+=c+": "+l.tooltip[c]+"<br/>";if(d3.selectAll("#tooltips-meta").html(h+"<br/>"),!l.tooltipmol)return;var d=S.util.spinner("#tooltips-meta");this.timeout=setTimeout(function(){var t=[];for(var s in d3.selectAll("#tooltips-mol").style("display","none"),l.tooltipmol){var e="#tooltips-mol-"+s;d3.selectAll("#tooltips-mol").append("div").attr("id","tooltips-mol-"+s).style("float","left").style("height","100%").style("width","50%"),d3.selectAll(e).html("<em>"+s+"</em><br/>");var a=o.mol2svg.draw(l.tooltipmol[s],e);t.push(a)}$.when.apply($,t).done(function(){d.css("display","none"),d3.selectAll("#tooltips-mol").style("display","inline")}).fail(function(){d.css("display","none")})},500)}else d3.selectAll("#tooltips-mol").html("")},mouseOutAction:function(){clearTimeout(this.timeout),d3.selectAll("#tooltips-mol").html(""),this.tooltips.transition().duration(300).style("opacity",0),this.tooltips.style("display","none")},renderLegend:function(){d3.select(this.target).select(".st-legend").remove();var t=d3.select(this.target).append("div").attr("class","st-legend").style("top",-(this.height+this.opts.margins[2])+"px").style("left",this.width+this.opts.margins[3]+"px").style("width",this.opts.margins[1]+"px").style("height",this.height/2-30+"px").style("position","relative");t=t.append("div").style("position","absolute").style("overflow","scroll").style("top","0px").style("left","0px").style("width",this.opts.margins[1]+30+"px").style("bottom","-30px");for(var s=this.colors,e=this,a=this.data.raw.series.length,i=t.append("svg:svg").attr("height",20*a+"px"),n=0;n<a;n++){var r=this.data.raw.series[n].id,o=this.data.raw.series[n].title,l=i.append("g").attr("stid",r).style("cursor","pointer");l.append("svg:rect").attr("x",5).attr("y",function(){return 20*n}).attr("width",10).attr("height",10).style("fill",function(){return s.get(r)}),l.append("text").attr("x",20).attr("y",function(){return 20*n+9}).text(function(){return o}),l.on("mouseover",function(){d3.select(this).style("fill","red");var t=d3.select(this).attr("stid");for(var s in e.canvas.selectAll("."+t).style("stroke-width",2),e.data.raw.ids)s!==t&&e.canvas.selectAll("."+s).style("opacity",.1)}),l.on("mouseout",function(){d3.select(this).style("fill","black");var t=d3.select(this).attr("stid");for(var s in e.canvas.selectAll("."+t).style("stroke-width",1),e.data.raw.ids)s!==t&&e.canvas.selectAll("."+s).style("opacity",1)})}},load:function(t){if(t)if("function"==typeof t.push&&"function"==typeof t.add&&"function"==typeof t.remove){var e=this,s=(this.data=t).add;t.add=function(){try{s.apply(this,arguments),e.data.push(function(){e.xscale(),e.yscale(),e.canvas.select(".st-xaxis").call(e.xaxis),e.canvas.select(".st-yaxis").call(e.yaxis),o(e),e.rendergroups(),e.opts.legend&&e.renderLegend()})}catch(t){console.log("Data load failed: "+t)}};var a=t.remove;t.remove=function(){var t=a.apply(this,arguments);for(var s in t)e.colors.remove(t[s]),e.canvas.selectAll("."+t[s]).remove();e.opts.legend&&e.renderLegend()}}else console.log("Invalid data object.");else console.log("Missing data object.")}}}function o(s){if("function"==typeof s.renderdata&&"function"==typeof s.renderlabels&&null!==s.data)try{var t=s.renderdata();s.renderlabels(t)}catch(t){s.data.remove(),console.log("Error rendering the data: "+t)}}function n(t){var s=d3.behavior.zoom().y(t.scales.y).center([0,t.scales.y(0)]).on("zoom",function(){o(t)});t.panel.call(s).on("mousedown.zoom",function(){t.mouseDown(this)}).on("mousemove.zoom",function(){t.mouseMove(this)}).on("mouseup.zoom",function(){t.mouseUp()}).on("mouseout",function(){t.mouseOut(this)}).on("dblclick.zoom",function(){t.mouseDbl(this)})}S.util={},S.util.cache=function(){var e={},a=[];return{add:function(t,s){-1===a.indexOf(t)&&a.push(t),e[t]=s},get:function(t){var s;return void 0!==e[t]&&(s="[object Object]"===e[t].toString()?$.extend(!0,{},e[t]):e[t]),s},getKey:function(t){return"[object Object]"===(s=t).toString()?$.param(s):s.toString();var s},exists:function(t){return e.hasOwnProperty(t)}}},S.util.colors=function(){var e={0:"red",1:"blue",2:"green",3:"orange",4:"yellow",5:"black"},a={size:function(){var t,s=-1;for(t in this)this.hasOwnProperty(t)&&s++;return s}},i=function(){var t=Object.keys(e).length,s=a.size();return e[s%t]};return{get:function(t){if(a[t])return a[t];var s=i();return a[t]=s,a[t]},remove:function(t){a[t]&&delete a[t]}}},S.util.hashcode=function(t){var s,e,a=0;if(0==t.length)return a;for(s=0,e=t.length;s<e;s++)a=(a<<5)-a+t.charCodeAt(s),a|=0;return a},S.util.domain=function(t,s){var e=t.domain();return e[0]>e[1]?[s[1],s[0]]:[s[0],s[1]]},S.util.mol2svg=function(t,s){var l=t||200,h=s||200,I=null,M=null,z=0,r=S.util.cache(),o=function(t,s){var e=t.split(/\r\n|\n/),a=e[3].match(/\d+/g),i=parseFloat(a[0]),n=parseFloat(a[1]),r=c(e,i),o=d(e,i,n);p(e,r,i+n);var l=u(r,s);f(r,o,l),v(r,z,l)},c=function(t,s){for(var e=[],a=4;a<s+4;a++){var i=t[a].match(/-*\d+\.\d+|\w+/g);e.push({x:parseFloat(i[0]),y:parseFloat(i[1]),symbol:i[3],mass:0,charge:0})}return e},d=function(t,s,e){for(var a=[],i=s+4;i<s+e+4;i++){var n=t[i].match(/\d+/g);a.push({a1:parseInt(n[0])-1,a2:parseInt(n[1])-1,order:parseInt(n[2]),stereo:parseInt(n[3])})}return a},p=function(t,s,e){for(var a=e+4;a<t.length;a++)if(-1!==t[a].indexOf("M  ISO"))for(var i=t[a].match(/-*\d+/g),n=0,r=1;n<i[0];n++,r+=2)s[i[r]-1].mass=parseInt(i[r+1],10);else if(-1!==t[a].indexOf("M  CHG"))for(i=t[a].match(/-*\d+/g),n=0,r=1;n<i[0];n++,r+=2)s[i[r]-1].charge=parseInt(i[r+1],10)},u=function(t,s){var e=d3.extent(t,function(t){return t.x}),a=d3.extent(t,function(t){return t.y}),i=[20,20,20,20],n=l-i[1]-i[3],r=h-i[0]-i[2],o=(e[1]-e[0])/(a[1]-a[0]);return 1<o?r/=o:n*=o,I=d3.scale.linear().domain([e[0],e[1]]).range([0,n]),M=d3.scale.linear().domain([a[0],a[1]]).range([r,0]),s.append("svg:svg").attr("width",n+i[1]+i[3]).attr("height",r+i[0]+i[2]).append("svg:g").attr("transform","translate("+i[3]+","+i[0]+")")},f=function(t,s,e){for(var a=0;a<s.length;a++){var i=t[s[a].a1],n=t[s[a].a2],r=n.x-i.x,o=n.y-i.y,l=Math.sqrt(r*r+o*o),h=r/l*.2,c=o/l*.2,d=i.x+h,p=i.y+c,u=n.x-h,f=n.y-c;z+=F(I(d),M(p),I(u),M(f));var v,g,m,x=[];if(1===s[a].order)if(1===s[a].stereo){var y=F(d,p,u,f);x=[[d,p],[u+(g=(v=.1)*(f-p)/y),f+(m=v*(d-u)/y)],[u-g,f-m]],e.append("svg:path").style("fill","black").style("stroke-width",1).attr("d",T(x))}else if(6===s[a].stereo){for(var w=u+(g=(v=.2)*(f-p)/l)-d,b=f+(m=v*(d-u)/l)-p,A=u-g-d,k=f-m-p,O=.05;O<=1;O+=.15)x.push([d+w*O,p+b*O],[d+A*O,p+k*O]);e.append("svg:path").style("fill","none").style("stroke-width",1).attr("d",L(x)).attr("stroke","black")}else if(4===s[a].stereo){for(w=u+(g=(v=.2)*(f-p)/l)-d,b=f+(m=v*(d-u)/l)-p,A=u-g-d,k=f-m-p,O=.05;O<=1;O+=.1)x.length%2==0?x.push([d+w*O,p+b*O]):x.push([d+A*O,p+k*O]);e.append("svg:path").attr("d",G(x)).attr("fill","none").style("stroke-width",1).attr("stroke","black")}else x=[[d,p],[u,f]],e.append("svg:path").attr("d",N(x)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black");else 2===s[a].order?(x=[[d+(g=(v=.1)*(f-p)/l),p+(m=v*(d-u)/l)],[u+g,f+m],[d-g,p-m],[u-g,f-m]],e.append("svg:path").attr("d",N(x)).attr("stroke-width","1").style("fill","none").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black")):3===s[a].order&&(x=[[d,p],[u,f],[d+(g=(v=.15)*(f-p)/l),p+(m=v*(d-u)/l)],[u+g,f+m],[d-g,p-m],[u-g,f-m]],e.append("svg:path").attr("d",N(x)).attr("stroke-width","1").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("stroke","black"))}z/=s.length},v=function(t,s,e){for(var a=0;a<t.length;a++){var i=t[a],n=d3.rgb(g[i.symbol]),r=e.append("svg:g").attr("transform","translate("+I(i.x)+","+M(i.y)+")");if(r.append("svg:circle").attr("r",Math.ceil(s/3)).attr("fill","white").attr("opacity","1"),r.append("text").attr("dy",Math.ceil(s/4.5)).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/1.5)).attr("fill",n).text(i.symbol),0!==i.charge){var o=i.charge;o=o<0?-1===o?"-":o+"-":1===o?"+":o+"+",r.append("text").attr("dx",1*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("fill",n).attr("font-size",Math.ceil(s/3)).text(o)}0!==i.mass&&r.append("text").attr("dx",-2*Math.ceil(s/3)).attr("dy",-1*Math.ceil(s/4.5)).attr("text-anchor","left").attr("font-family","sans-serif").attr("font-size",Math.ceil(s/3)).attr("fill",n).text(i.mass)}},F=function(t,s,e,a){return Math.sqrt((e-t)*(e-t)+(a-s)*(a-s))},N=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],e=1;e<t.length;e++)s+=e%2==0?"M"+t[e][0]+","+t[e][1]:"L"+t[e][0]+","+t[e][1];return s}).x(function(t){return I(t[0])}).y(function(t){return M(t[1])}),T=d3.svg.line().x(function(t){return I(t[0])}).y(function(t){return M(t[1])}),L=d3.svg.line().interpolate(function(t){for(var s=t[0][0]+","+t[0][1],e=1;e<t.length;e++)s+=e%2==0?"M"+t[e][0]+","+t[e][1]:"L"+t[e][0]+","+t[e][1];return s}).x(function(t){return I(t[0])}).y(function(t){return M(t[1])}),G=d3.svg.line().interpolate("cardinal").x(function(t){return I(t[0])}).y(function(t){return M(t[1])}),g={H:"#000000",He:"#FFC0CB",Li:"#B22222",B:"#00FF00",C:"#000000",N:"#8F8FFF",O:"#F00000",F:"#DAA520",Na:"#0000FF",Mg:"#228B22",Al:"#808090",Si:"#DAA520",P:"#FFA500",S:"#FFC832",Cl:"#00FF00",Ca:"#808090",Ti:"#808090",Cr:"#808090",Mn:"#808090",Fe:"#FFA500",Ni:"#A52A2A",Cu:"#A52A2A",Zn:"#A52A2A",Br:"#A52A2A",Ag:"#808090",I:"#A020F0",Ba:"#FFA500",Au:"#DAA520"};return{draw:function(t,s){var e,a=d3.select(s),i=r.getKey(t);if(r.exists(i)){var n=r.get(i);o(n,a)}else e=$.when($.get(t)).fail(function(){console.log("Request failed for: "+t)}).then(function(t){r.add(i,t);try{o(t,a)}catch(t){console.log("Mol2Svg Error:"+t),a.html("")}});return e}}},S.util.spinner=function(t){return $(".st-spinner").length||$(t).append('<div class="st-spinner"><div class="st-bounce1"></div><div class="st-bounce2"></div><div class="st-bounce3"></div></div>'),$(".st-spinner")},S.util.compare=function(e){return function(t,s){return t[e]<s[e]?-1:t[e]>s[e]?1:0}},S.annotation={TOOLTIP:"tooltip",TOOLTIP_MOL:"tooltip_mol",ANNOTATION:"annotation",ANNOTATION_COLOR:"annotation_color"},S.parser={},S.parser.jdx=function(t,v){d3.text(t,function(t){var s,e,a,i,n=[],r={},o=!1,l=[],h=t.split(/\r\n|\r|\n/g);for(var c in h){var d=h[c];if(0===d.indexOf("##")){if((s=d.split(/=\s(.*)/)).length<2)continue;e=s[0].slice(2),i=s[1].split(/\$\$(.*)/)[0].trim(),"XYDATA"===e&&"(X++(Y..Y))"===i?o=!0:"END"===e?(o&&(parseFloat(r.FIRSTX)>parseFloat(r.LASTX)&&l.reverse(),r[a]=l,n.push(r),o=!(r={}),l=[]),o=!1):r[e]=i,a=e}else if(o)for(var p=d.match(/(\+|-)*\d+\.*\d*/g),u=1;u<p.length;u++){var f=r.YFACTOR*p[u];l.push(f)}}v(n)})},S.data={},S.data.set=function(){var I=s();return I.x=function(t){return t&&"string"==typeof t?this.opts.x=t:console.log("Invalid y accessor option."),this},I.get=function(t,s){var e=[],a=[s.invert(0),s.invert(t)];for(var i in a=S.util.domain(s,a),this.raw.series){var n=this.raw.series[i],r=[];for(var o in n.data){var l=n.x(o);l>=a[0]&&l<=a[1]&&r.push(n.data[o])}e.push(r)}return e},I.bin=function(t,s,e){var a=[],i=[s.invert(0),s.invert(t)];i=S.util.domain(s,i);var n=0;for(var r in this.raw.series){(c=this.raw.series[r].size)[2]=Math.ceil(t/1),n<c[2]&&(n=c[2])}var o=Math.abs(i[1]-i[0])/(n-1);for(var r in this.raw.series){for(var l=this.raw.series[r],h=l.data.length,c=l.size,d=[],p=0;0<c[0];){if((f=l.x(c[0]))<i[0])break;c[0]-=1}for(;c[1]<h;){if((f=l.x(c[1]))>i[1])break;c[1]+=1}for(var u=c[0];u<c[1];u++){var f;if((f=l.x(u))<i[0])c[0]=u;else{if(f>i[1]){c[1]=u;break}var v=Math.floor((f-i[0])/o),g=d[v-p],m=l.data[u];g?e?g[l.accs[1]]<m[l.accs[1]]?d[v-p]=g:(g.annos&&!m.annos&&(m.annos=g.annos),d[v-p]=m):Math.abs(g[l.accs[1]])>Math.abs(m[l.accs[1]])?d[v-p]=g:(g.annos&&!m.annos&&(m.annos=g.annos),d[v-p]=m):d[v-(p=v-d.length)]=m}}0<p&&(c[2]=d.length),l.size=c,a.push(d)}return a},I.seriesfetch=function(t,s){var e=S.util.hashcode((new Date).getTime()*Math.random()+"");e="st"+e;var a,i,n,r=t[I.opts.title],o=this.opts.x,l=this.opts.y;if(r&&0!==r.length||(r=e),e in this.raw.ids)console.log("SpeckTackle: Non unique identifier: "+e);else{var h="";-1!==o.lastIndexOf(".")&&(h=o.substr(0,o.lastIndexOf(".")),o=o.substr(o.lastIndexOf(".")+1),l=l.substr(l.lastIndexOf(".")+1));var c=""===h?t:t[h];if(!(c instanceof Array)){var d=[];for(var p in c[o]){var u={};u[o]=c[o][p],u[l]=c[l][p],d.push(u)}c=d}if(a=M(c,t,this.opts.xlimits,o),i=M(c,t,this.opts.ylimits,l),n=[0,c.length,0],s){c.sort(S.util.compare(o));var f=d3.bisector(function(t){return t[o]}).left,v=this.opts.annoTypes.length;for(var p in s)if(s[p].length-2===v){var g=s[p][0];g in this.raw.annoGroups||(this.raw.annoGroups[g]=0);var m=s[p][1],x=f(c,m);if(-1!==x&&m===c[x][o]){var y=c[x];y.annos||(y.annos={});var w=y.annos;g in w||(w[g]={});for(var b=w[g],A=0;A<v;A++){var k=this.opts.annoTypes[A],O=s[p][A+2];k===S.annotation.ANNOTATION?b.annotation=O:k===S.annotation.TOOLTIP?(b.tooltip||(b.tooltip={}),b.tooltip[this.opts.annoTexts[A]]=O):k===S.annotation.TOOLTIP_MOL&&""!==O&&(b.tooltipmol||(b.tooltipmol={}),b.tooltipmol[this.opts.annoTexts[A]]=O)}}}}a[0]<this.raw.gxlim[0]&&(this.raw.gxlim[0]=a[0]),i[0]<this.raw.gylim[0]&&(this.raw.gylim[0]=i[0]),a[1]>this.raw.gxlim[1]&&(this.raw.gxlim[1]=a[1]),i[1]>this.raw.gylim[1]&&(this.raw.gylim[1]=i[1]),this.raw.ids[e]=!0,this.raw.series.push({id:e,title:r,xlim:a,ylim:i,accs:[o,l],size:n,data:c,x:function(t){return this.data[t][this.accs[0]]},y:function(t){return this.data[t][this.accs[1]]}})}},I},S.data.array=function(){var t=s();return t.get=function(t,s){var e=[],a=[s.invert(0),s.invert(t)];for(var i in a=S.util.domain(s,a),this.raw.series){for(var n=this.raw.series[i],r=n.data.length,o=(n.xlim[1]-n.xlim[0])/r,l=n.size,h=[];0<n.size[0];){if((d=n.size[0]*o+n.xlim[0])<a[0])break;n.size[0]-=1}for(;n.size[1]<r;){if((d=n.size[1]*o+n.xlim[0])>a[1])break;n.size[1]+=1}for(var c=n.size[0];c<n.size[1];c++){var d;if((d=c*o+n.xlim[0])<a[0])l[0]=c;else{if(d>a[1]){l[1]=c;break}var p=n.data[c],u={x:d};u[n.accs[1]]=p,h.push(u)}}n.size=l,e.push(h)}return e},t.bin=function(t,s,e){var a=[],i=[s.invert(0),s.invert(t)];i=S.util.domain(s,i);var n=0;for(var r in this.raw.series){(d=this.raw.series[r].size)[2]=Math.ceil(t/1),n<d[2]&&(n=d[2])}var o=Math.abs(i[1]-i[0])/(n-1);for(var r in this.raw.series){for(var l=this.raw.series[r],h=l.data.length,c=(l.xlim[1]-l.xlim[0])/h,d=l.size,p=[],u=0;0<l.size[0];){if((v=l.size[0]*c+l.xlim[0])<i[0])break;l.size[0]-=1}for(;l.size[1]<h;){if((v=l.size[1]*c+l.xlim[0])>i[1])break;l.size[1]+=1}for(var f=l.size[0];f<l.size[1];f++){var v;if((v=f*c+l.xlim[0])<i[0])d[0]=f;else{if(v>i[1]){d[1]=f;break}var g,m,x=Math.floor((v-i[0])/o),y=p[x-u],w=l.data[f];if(y)if(e)if(y[l.accs[1]]<w)p[x-u]=y;else(g={x:v})[l.accs[1]]=w,(m=p[x-u]).annos&&(g.annos=p[x-u].annos),p[x-u]=g;else if(Math.abs(y[l.accs[1]])>Math.abs(w))p[x-u]=y;else(g={x:v})[l.accs[1]]=w,(m=p[x-u]).annos&&(g.annos=m.annos),p[x-u]=g;else p[x-(u=x-p.length)]={x:v},p[x-u][l.accs[1]]=w;if(l.annos&&Object.keys(l.annos).length&&f in l.annos&&!p[x-u].annos){var b=p[x-u],A=l.annos[f],k=A[0];k in this.raw.annoGroups||(this.raw.annoGroups[k]=0),b.annos||(b.annos={});var O=b.annos;k in O||(O[k]={});for(var I=O[k],M=0;M<A.length;M++){var z=this.opts.annoTypes[M],F=A[M+2];z===S.annotation.ANNOTATION?I.annotation=F:z===S.annotation.TOOLTIP?(I.tooltip||(I.tooltip={}),I.tooltip[this.opts.annoTexts[M]]=F):z===S.annotation.TOOLTIP_MOL&&""!==F&&(I.tooltipmol||(I.tooltipmol={}),I.tooltipmol[this.opts.annoTexts[M]]=F)}p[x-u]=b}}}0<u&&(d[2]=p.length),l.size=d,a.push(p)}return a},t.seriesfetch=function(t,s){var e=S.util.hashcode((new Date).getTime()*Math.random()+"");e="st"+e;var a,i,n,r=t[this.opts.title],o=this.opts.y;if(r&&0!==r.length||(r=e),e in this.raw.ids)console.log("SpeckTackle: Non unique identifier: "+e);else{var l=""===o?t:t[o];a=M(l,t,this.opts.xlimits,"x"),i=M(l,t,this.opts.ylimits),n=[0,l.length,0];var h={};if(s){var c=this.opts.annoTypes.length;for(var d in s)if(s[d].length-2===c){var p=s[d][1];p<n[1]&&(h[p]=s[d])}}a[0]<this.raw.gxlim[0]&&(this.raw.gxlim[0]=a[0]),i[0]<this.raw.gylim[0]&&(this.raw.gylim[0]=i[0]),a[1]>this.raw.gxlim[1]&&(this.raw.gxlim[1]=a[1]),i[1]>this.raw.gylim[1]&&(this.raw.gylim[1]=i[1]),this.raw.ids[e]=!0,this.raw.series.push({id:e,title:r,xlim:a,ylim:i,accs:["x",o],size:n,annos:h,data:l,x:function(t){return t},y:function(t){return this.data[t][this.accs[1]]}})}},t},S.chart={},S.chart.series=function(){var t=e();return t.xscale=function(){var t=this.data.raw.gxlim;this.opts.xreverse&&(t=[t[1],t[0]]),this.scales.x.domain(t).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var h=this,c=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var t=d3.mouse(this)[0]-h.opts.margins[3],s=h.scales.x.invert(t),e=h.scales.x.domain();if(h.opts.xreverse)var a=function(){return s<e[0]&&s>=e[1]};else a=function(){return s>=e[0]&&s<e[1]};if(a()){h.xpointer.text("x = "+c(s));for(var i=0;i<h.plotted.length;i++){var n=h.data.accs(i),r=(0,d3.bisector(function(t){return t[n[0]]}).left)(h.plotted[i],s);r>h.plotted[i].length-1&&(r=h.plotted[i].length-1);var o=h.plotted[i][r];if(o){var l=h.scales.y(o[n[1]]);l<0?l=0:l>h.height&&(l=h.height),h.canvas.select("."+h.data.id(i)+"focus").attr("display","inline").attr("transform","translate("+h.scales.x(o[n[0]])+","+l+")")}}}else{h.xpointer.text("");for(i=0;i<h.plotted.length;i++)h.canvas.select("."+h.data.id(i)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x);this.plotted=t;for(var s=this,e=0;e<t.length;e++){var a=t[e],i=this.data.id(e),n=this.data.accs(e),r=this.colors.get(i),o=d3.svg.line().interpolate("cardinal-open").x(function(t){return s.scales.x(t[n[0]])}).y(function(t){return s.scales.y(t[n[1]])});this.canvas.selectAll("."+i).remove();var l=this.canvas.append("g").attr("class",i);l.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",r).style("fill","none").style("stroke-width",1).attr("d",o(a)),l.append("svg:circle").attr("class",i+"focus").style("stroke",r).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),l.selectAll("."+i+".circle").data(a).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",r).style("stroke",r).attr("opacity",0).attr("r",3).attr("cx",function(t){return s.scales.x(t[n[0]])}).attr("cy",function(t){return s.scales.y(t[n[1]])}).on("mouseover",function(t){d3.select(this).attr("opacity",.8),s.mouseOverAction(this,t,n)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),s.mouseOutAction()})}return t},t},S.chart.ms=function(){var t=e();return t.xscale=function(){this.scales.x.domain(this.data.raw.gxlim).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x),s="";for(var e in this.data.raw.annoGroups)if(this.data.raw.annoGroups[e]){s=e;break}for(var a=this,i=0;i<t.length;i++){var n=t[i],r=this.data.id(i),o=this.data.accs(i),l=a.colors.get(r);this.canvas.selectAll("."+r).remove();var h=this.canvas.append("g").attr("class",r);h.selectAll("."+r+".line").data(n).enter().append("svg:line").attr("clip-path","url(#clip-"+this.target+")").attr("x1",function(t){return a.scales.x(t[o[0]])}).attr("y1",function(t){return a.scales.y(t[o[1]])}).attr("x2",function(t){return a.scales.x(t[o[0]])}).attr("y2",a.scales.y(0)).style("stroke",l).each(function(t){if(t.annos){if(!(s in t.annos))return;h.append("text").attr("class",r+".anno").attr("x",a.scales.x(t[o[0]])).attr("y",a.scales.y(t[o[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",l).text(t.annos[s].annotation)}}).on("mouseover",function(t){d3.select(this).attr("stroke-width",2),a.mouseOverAction(this,t,o,s)}).on("mouseout",function(){d3.select(this).attr("stroke-width",null),a.mouseOutAction()})}return this.canvas.selectAll(".zeroline").remove(),this.data.raw.gylim[0]<0&&this.canvas.append("svg:line").attr("class","zeroline").attr("clip-path","url(#clip-"+this.target+")").attr("x1",this.scales.x(this.data.raw.gxlim[0])).attr("y1",this.scales.y(0)).attr("x2",this.scales.x(this.data.raw.gxlim[1])).attr("y2",this.scales.y(0)).style("stroke","#333333"),t},t},S.chart.ir=function(){var t=e();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.xpointer=this.panel.append("text").attr("x",this.opts.margins[3]).attr("y",this.opts.margins[0]).attr("font-size","x-small").text("");var l=this,h=d3.format(".4g");this.plotted=[],this.panel.on("mousemove",function(){var t=d3.mouse(this)[0]-l.opts.margins[3],s=l.scales.x.invert(t),e=l.scales.x.domain();if(s<e[0]&&s>=e[1]){l.xpointer.text("x = "+h(s));for(var a=0;a<l.plotted.length;a++){var i=l.data.accs(a),n=(0,d3.bisector(function(t){return t[i[0]]}).left)(l.plotted[a],s);n>l.plotted[a].length-1&&(n=l.plotted[a].length-1);var r=l.plotted[a][n];if(r){var o=l.scales.y(r[i[1]]);o<0?o=0:o>l.height&&(o=l.height),l.canvas.select("."+l.data.id(a)+"focus").attr("display","inline").attr("transform","translate("+l.scales.x(r[i[0]])+","+o+")")}}}else{l.xpointer.text("");for(a=0;a<l.plotted.length;a++)l.canvas.select("."+l.data.id(a)+"focus").attr("display","none")}})},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x,!0),s="";for(var e in this.data.raw.annoGroups)if(this.data.raw.annoGroups[e]){s=e;break}this.data.raw.minima=1,this.plotted=t;for(var a=this,i=0;i<t.length;i++){var n=t[i],r=this.data.id(i),o=this.data.accs(i),l=this.colors.get(r),h=d3.svg.line().interpolate("cardinal-open").x(function(t){return a.scales.x(t[o[0]])}).y(function(t){return a.scales.y(t[o[1]])});this.canvas.selectAll("."+r).remove();var c=this.canvas.append("g").attr("class",r);c.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",l).style("fill","none").attr("d",h(n)),c.append("svg:circle").attr("class",r+"focus").style("stroke",l).style("fill","none").attr("r",3).attr("cx",0).attr("cy",0).attr("display","none"),c.selectAll("."+r+".circle").data(n).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",l).style("stroke",l).attr("opacity",0).attr("r",3).attr("cx",function(t){return a.scales.x(t[o[0]])}).attr("cy",function(t){return a.scales.y(t[o[1]])}).each(function(t){if(t.annos){if(!(s in t.annos))return;c.append("text").attr("class",r+".anno").attr("x",a.scales.x(t[o[0]])).attr("y",a.scales.y(t[o[1]])+20).attr("text-anchor","middle").attr("font-size","small").attr("fill",l).text(t.annos[s].annotation)}}).on("mouseover",function(t){d3.select(this).attr("opacity",.8),a.mouseOverAction(this,t,o,s)}).on("mouseout",function(){d3.select(this).attr("opacity","0"),a.mouseOutAction()})}return t},t},S.chart.nmr=function(){var t=e();return t.render=function(t){this.target=t;var s=this.opts.margins;if(this.width=$(t).width()-s[1]-s[3],this.height=$(t).height()-s[0]-s[2],this.width<=0)console.log("Invalid chart width: "+this.width);else{if(!(this.height<=0)){var e=this;if(this.scales={x:d3.scale.linear().domain([1,0]).range([0,this.width]),y:d3.scale.linear().range([this.height,0])},this.panel=d3.select(t).append("svg:svg").attr("class","st-base").attr("width",this.width+s[1]+s[3]).attr("height",this.height+s[0]+s[2]),n(e),this.canvas=this.panel.append("svg:g").attr("transform","translate("+s[3]+","+s[0]+")"),this.canvas.append("svg:clipPath").attr("id","clip-"+this.target).append("svg:rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height),this.selection=this.canvas.append("svg:rect").attr("class","st-selection").attr("clip-path","url(#clip-"+this.target+")").attr("x",0).attr("y",0).attr("width",0).attr("height",0).style("pointer-events","none").attr("display","none"),this.renderAxes(),this.opts.title&&0!==this.opts.title.length&&(s[0]<20?console.log("Not enough space for chart title: increase top margin (min 20)"):this.panel.append("text").attr("class","st-title").attr("x",s[3]+this.width/2).attr("y",.75*s[0]).attr("text-anchor","middle").attr("font-size","large").text(this.opts.title)),this.opts.labels){if(s[1]<60)return void console.log("Not enough space for label option: increase right margin (min 60)");var a=this.canvas.append("g").attr("id","st-options");a.append("text").attr("x",this.width).attr("y",this.height-this.height/4).text("Options");var i=a.append("g");i.append("svg:circle").attr("cx",this.width+5).attr("cy",this.height-this.height/5).attr("r",2).style("fill","#333333").style("stroke","#333333"),i.append("text").attr("x",this.width+12).attr("y",this.height-this.height/5+2).text("Labels").attr("id","st-label").style("cursor","pointer"),i.on("mousedown",function(){var t=d3.select(this);"none"===t.style("stroke")?t.style("stroke","#333333"):t.style("stroke","none"),o(e)})}return this}console.log("Invalid chart height: "+this.height)}},t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain(this.data.raw.gylim)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".4g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).orient("bottom"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),""!==this.opts.xlabel&&this.panel.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2)},t.mouseDown=function(t){var s=d3.mouse(t),e=this.opts.margins[3];this.panel.select(".st-selection").attr("x",s[0]-e).attr("xs",s[0]-e).attr("width",1).attr("height",this.height).attr("display","inline")},t.mouseMove=function(t){var s=this.panel.select(".st-selection");if("inline"===s.attr("display")){var e=d3.mouse(t)[0]-this.opts.margins[3],a=parseInt(s.attr("width"),10),i=e-parseInt(s.attr("x"),10),n=parseInt(s.attr("xs"),10);i<1&&2*i<a?(s.attr("x",e),s.attr("width",n-e)):s.attr("width",i)}},t.mouseUp=function(){var t=this.panel.select(".st-selection");if(5<parseInt(t.attr("width"))){var s=parseFloat(t.attr("x")),e=parseFloat(t.attr("width"));e=this.scales.x.invert(s+e),s=this.scales.x.invert(s),this.scales.x.domain([s,e]).nice(),t.attr("display","none"),this.canvas.select(".st-xaxis").call(this.xaxis),o(this)}else t.attr("display","none")},t.mouseDbl=function(t){if(t){var s=d3.mouse(t)[0]-this.opts.margins[3],e=d3.mouse(t)[1]-this.opts.margins[0];if(s<0||s>this.width||e<0||e>this.height)return}if(null===this.data)return this.scales.x.domain([1,0]).nice(),this.scales.y.domain([0,1]).nice(),void this.canvas.select(".st-xaxis").call(this.xaxis);this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice(),this.scales.y.domain(this.data.raw.gylim),this.canvas.select(".st-xaxis").call(this.xaxis),o(this)},t.load=function(t){if(t)if("function"==typeof t.push&&"function"==typeof t.add&&"function"==typeof t.remove){var e=this,s=(this.data=t).add;t.add=function(){s.apply(this,arguments),e.data.push(function(){e.xscale(),e.yscale(),n(e),e.canvas.select(".st-xaxis").call(e.xaxis),o(e),e.rendergroups(),e.opts.legend&&e.renderLegend()})};var a=t.remove;t.remove=function(){var t=a.apply(this,arguments);for(var s in t)e.colors.remove(t[s]),e.canvas.selectAll("."+t[s]).remove();e.opts.legend&&e.renderLegend()}}else console.log("Invalid data object.");else console.log("Missing data object.")},t.renderdata=function(){var t=this.data.bin(this.width,this.scales.x),s="";for(var e in this.data.raw.annoGroups)if(this.data.raw.annoGroups[e]){s=e;break}for(var a=this,i=0;i<t.length;i++){var n=t[i],r=this.data.id(i),o=this.data.accs(i),l=d3.svg.line().x(function(t){return a.scales.x(t[o[0]])}).y(function(t){return a.scales.y(t[o[1]])});this.canvas.selectAll("."+r).remove();var h=this.canvas.append("g").attr("class",r);h.append("svg:path").attr("clip-path","url(#clip-"+this.target+")").style("stroke",this.colors.get(r)).style("fill","none").style("stroke-width",1).attr("d",l(n)),h.data(n).each(function(t){if(t.annos){if(!(s in t.annos))return;h.append("text").attr("class",r+".anno").attr("x",a.scales.x(t[o[0]])).attr("y",a.scales.y(t[o[1]])-5).attr("text-anchor","middle").attr("font-size","small").attr("fill",color).text(t.annos[s].annotation)}})}return t},t},S.chart.nmr2d=function(){var t=e();return t.xscale=function(){this.scales.x.domain([this.data.raw.gxlim[1],this.data.raw.gxlim[0]]).nice()},t.yscale=function(){this.scales.y.domain([this.data.raw.gylim[1],this.data.raw.gylim[0]]).nice()},t.behavior=function(){this.scales.x.domain([1,0]),this.scales.y.domain([1,0]);var e=this.canvas.append("svg:rect").attr("class","st-selection").attr("y",0).attr("width",1).attr("height",this.height).style("pointer-events","none").attr("visibility","hidden"),a=this.canvas.append("svg:rect").attr("class","st-selection").attr("x",0).attr("width",this.width).attr("height",1).style("pointer-events","none").attr("visibility","hidden"),i=this;d3.select(".st-base").on("mousemove",function(){var t=d3.mouse(this)[0]-i.opts.margins[3],s=d3.mouse(this)[1]-i.opts.margins[0];t<0||t>i.width||s<0||s>i.height?(e.attr("visibility","hidden"),a.attr("visibility","hidden")):(e.attr("x",t),a.attr("y",s),e.attr("visibility","visible"),a.attr("visibility","visible"))}).append("svg:rect").attr("class","st-mouse-capture").style("visibility","hidden").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height)},t.renderAxes=function(){var t=this.opts.margins,s=d3.format(".3g");this.xaxis=d3.svg.axis().scale(this.scales.x).ticks(6).tickSubdivide(!0).tickFormat(s).tickSize(-this.height).tickPadding(5).orient("bottom"),this.yaxis=d3.svg.axis().scale(this.scales.y).ticks(6).tickFormat(s).tickSize(-this.width).tickPadding(5).orient("right"),this.canvas.append("svg:g").attr("class","st-xaxis").attr("transform","translate(0,"+this.height+")").call(this.xaxis),this.canvas.append("svg:g").attr("class","st-yaxis").attr("transform","translate("+this.width+",0)").call(this.yaxis),""!==this.opts.xlabel&&d3.select(".st-xaxis").append("text").text(this.opts.xlabel).attr("text-anchor","middle").attr("x",this.width/2).attr("y",t[2]/2),""!==this.opts.ylabel&&d3.select(".st-yaxis").append("text").text(this.opts.ylabel).attr("transform","rotate (-90)").attr("text-anchor","middle").attr("x",0-this.height/2).attr("y",t[1]/2)},t.renderdata=function(){for(var t=this.data.get(this.width,this.scales.x),s=this,e=0;e<t.length;e++){var a=t[e],i=this.data.id(e),n=this.data.accs(e);this.canvas.selectAll("."+i).remove(),this.canvas.append("g").attr("class",i).selectAll("."+i+".circle").data(a).enter().append("svg:circle").attr("clip-path","url(#clip-"+this.target+")").style("fill",this.colors.get(i)).style("stroke",this.colors.get(i)).attr("r",3).attr("cx",function(t){return s.scales.x(t[n[0]])}).attr("cy",function(t){return s.scales.y(t[n[1]])}).on("mouseover",function(t){s.mouseOverAction(this,t,n)}).on("mouseout",function(){s.mouseOutAction()})}},t},"function"==typeof define&&define.amd?define(S):"object"==typeof module&&module.exports?module.exports=S:this.st=S}();